{% extends "base.html" %}

{% block title %}–°–æ–∑–¥–∞—Ç—å –ø–æ—Å—Ç - Chic & Chat{% endblock %}

{% block content %}
<div class="container">
    <div class="card" style="max-width: 800px; margin: 0 auto;">
        <h2>–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø–æ—Å—Ç</h2>
        
        <form id="createPostForm" style="margin-top: 2rem;">
            <div class="form-group">
                <label for="title">–ó–∞–≥–æ–ª–æ–≤–æ–∫</label>
                <input type="text" id="title" required>
            </div>
            
            <div class="form-group">
                <label for="content">–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ</label>
                <textarea id="content" required style="min-height: 300px;"></textarea>
            </div>
            
            <div class="form-group">
                <label for="tags">–¢–µ–≥–∏ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)</label>
                <input type="text" id="tags" placeholder="–º–æ–¥–∞, –∫—Ä–∞—Å–æ—Ç–∞, –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è">
            </div>
            
            <button type="submit" class="btn" style="width: 100%;">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –ø–æ—Å—Ç</button>
        </form>
    </div>
</div>

<script>
document.getElementById('createPostForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const title = document.getElementById('title').value;
    const content = document.getElementById('content').value;
    const tagsInput = document.getElementById('tags').value;
    const tags = tagsInput ? tagsInput.split(',').map(t => t.trim()).filter(Boolean) : [];
    
    try {
        const response = await apiRequest('/api/v1/posts', {
            method: 'POST',
            body: JSON.stringify({
                post_title: title,
                post_content: content,
                tag_names: tags,
                is_published: true
            })
        });
        
        if (response.ok) {
            const post = await response.json();
            showAlert('–ü–æ—Å—Ç –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω! üéâ', 'success');
            setTimeout(() => {
                window.location.href = `/post/${post.id}`;
            }, 1000);
        } else {
            const error = await response.json();
            showAlert(error.detail || '–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ—Å—Ç–∞', 'error');
        }
    } catch (error) {
        showAlert('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è', 'error');
    }
});
</script>
{% endblock %}
