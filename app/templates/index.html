{% extends "base.html" %}

{% block content %}
<div class="container">
    <!-- Hero Section -->
    <div class="hero fade-in">
        <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Chic & Chat</h1>
        <p>–≠–ª–µ–≥–∞–Ω—Ç–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –¥–ª—è –≤–∞—à–∏—Ö –º—ã—Å–ª–µ–π, –∏—Å—Ç–æ—Ä–∏–π –∏ –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏—è. –ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å –∫ —Å–æ–æ–±—â–µ—Å—Ç–≤—É —É—Ç–æ–Ω—á–µ–Ω–Ω—ã—Ö –∂–µ–Ω—â–∏–Ω, –∫–æ—Ç–æ—Ä—ã–µ –¥–µ–ª—è—Ç—Å—è —Å–≤–æ–∏–º–∏ –ø–µ—Ä–µ–∂–∏–≤–∞–Ω–∏—è–º–∏ –∏ –æ—Ç–∫—Ä—ã—Ç–∏—è–º–∏.</p>
        <div style="display: flex; gap: 1rem; justify-content: center; margin-top: 2rem;">
            <a href="#" onclick="openModal('registerModal')" class="btn">–ù–∞—á–∞—Ç—å –ø–∏—Å–∞—Ç—å</a>
            <a href="/posts" class="btn btn-outline">–ß–∏—Ç–∞—Ç—å –ø–æ—Å—Ç—ã</a>
        </div>
    </div>

    <!-- Featured Posts -->
    <section>
        <h2 style="text-align: center; margin-bottom: 2rem;">–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –ø–æ—Å—Ç—ã</h2>
        <div id="featuredPosts" class="grid-2">
            <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å—Ç–æ–≤</div>
        </div>
    </section>

    <!-- Categories -->
    <section style="margin-top: 4rem;">
        <h2 style="text-align: center; margin-bottom: 2rem;">–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–µ–º—ã</h2>
        <div class="tags" style="justify-content: center;">
            <a href="/posts?tag=–º–æ–¥–∞" class="tag">üíÉ –ú–æ–¥–∞</a>
            <a href="/posts?tag=–∫—Ä–∞—Å–æ—Ç–∞" class="tag">üíÑ –ö—Ä–∞—Å–æ—Ç–∞</a>
            <a href="/posts?tag=–ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è" class="tag">‚úàÔ∏è –ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è</a>
            <a href="/posts?tag=—Å—Ç–∏–ª—å-–∂–∏–∑–Ω–∏" class="tag">üå∏ –°—Ç–∏–ª—å –∂–∏–∑–Ω–∏</a>
            <a href="/posts?tag=–∫—É–ª–∏–Ω–∞—Ä–∏—è" class="tag">üç∞ –ö—É–ª–∏–Ω–∞—Ä–∏—è</a>
            <a href="/posts?tag=–∏–Ω—Ç–µ—Ä—å–µ—Ä" class="tag">üè° –ò–Ω—Ç–µ—Ä—å–µ—Ä</a>
            <a href="/posts?tag=–æ—Ç–Ω–æ—à–µ–Ω–∏—è" class="tag">üíï –û—Ç–Ω–æ—à–µ–Ω–∏—è</a>
            <a href="/posts?tag=—Å–∞–º–æ—Ä–∞–∑–≤–∏—Ç–∏–µ" class="tag">ÔøΩÔøΩ –°–∞–º–æ—Ä–∞–∑–≤–∏—Ç–∏–µ</a>
        </div>
    </section>

    <!-- Call to Action -->
    <section style="margin-top: 4rem; text-align: center;">
        <div class="card" style="max-width: 600px; margin: 0 auto; padding: 3rem;">
            <h2>–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å –∫ –Ω–∞—à–µ–º—É —Å–æ–æ–±—â–µ—Å—Ç–≤—É</h2>
            <p>–°–æ–∑–¥–∞–≤–∞–π—Ç–µ –ø–æ—Å—Ç—ã, –¥–µ–ª–∏—Ç–µ—Å—å –º–Ω–µ–Ω–∏—è–º–∏, –Ω–∞—Ö–æ–¥–∏—Ç–µ –µ–¥–∏–Ω–æ–º—ã—à–ª–µ–Ω–Ω–∏—Ü –∏ –≤–¥–æ—Ö–Ω–æ–≤–ª—è–π—Ç–µ—Å—å.</p>
            <a href="#" onclick="openModal('registerModal')" class="btn" style="margin-top: 1rem;">–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</a>
        </div>
    </section>
</div>

<script>
// Load featured posts
async function loadFeaturedPosts() {
    try {
        const response = await fetch('/api/v1/posts?page=1&page_size=6');
        const posts = await response.json();
        
        const container = document.getElementById('featuredPosts');
        if (posts.length === 0) {
            container.innerHTML = '<p style="text-align: center; grid-column: 1/-1;">–ü–æ–∫–∞ –Ω–µ—Ç –ø–æ—Å—Ç–æ–≤. –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤–æ–π! üíï</p>';
            return;
        }
        
        container.innerHTML = posts.map(post => `
            <article class="post-card card fade-in">
                <h3><a href="/post/${post.id}">${escapeHtml(post.post_title)}</a></h3>
                <div class="post-meta">
                    <span>üë§ ${escapeHtml(post.author.username)}</span>
                    <span>‚ù§Ô∏è ${post.likes_count}</span>
                    <span>üí¨ ${post.comments_count}</span>
                    <span>üìÖ ${formatDate(post.created_at)}</span>
                </div>
                ${post.tags.length > 0 ? `
                    <div class="tags">
                        ${post.tags.map(tag => `<span class="tag">${escapeHtml(tag.tag_name)}</span>`).join('')}
                    </div>
                ` : ''}
                <div class="post-content">
                    <p>${escapeHtml(post.post_content.substring(0, 200))}${post.post_content.length > 200 ? '...' : ''}</p>
                </div>
                <a href="/post/${post.id}" class="btn btn-outline" style="margin-top: 1rem;">–ß–∏—Ç–∞—Ç—å –¥–∞–ª–µ–µ</a>
            </article>
        `).join('');
    } catch (error) {
        console.error('Error loading posts:', error);
        document.getElementById('featuredPosts').innerHTML = '<p class="alert alert-error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ—Å—Ç–æ–≤</p>';
    }
}

function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

function formatDate(dateString) {
    const date = new Date(dateString);
    const now = new Date();
    const diffMs = now - date;
    const diffMins = Math.floor(diffMs / 60000);
    const diffHours = Math.floor(diffMs / 3600000);
    const diffDays = Math.floor(diffMs / 86400000);
    
    if (diffMins < 60) return `${diffMins} –º–∏–Ω –Ω–∞–∑–∞–¥`;
    if (diffHours < 24) return `${diffHours} —á –Ω–∞–∑–∞–¥`;
    if (diffDays < 7) return `${diffDays} –¥–Ω –Ω–∞–∑–∞–¥`;
    
    return date.toLocaleDateString('ru-RU', { day: 'numeric', month: 'long', year: 'numeric' });
}

// Load posts on page load
loadFeaturedPosts();
</script>
{% endblock %}
