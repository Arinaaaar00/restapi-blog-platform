"""Initialize database with tables and sample data"""

from app.database import Base, User, Post, Tag, Comment
from app.db_utils import engine
from app.auth import get_password_hash
from sqlalchemy.orm import Session


def init_db():
    """Create all tables"""
    print("Creating database tables...")
    Base.metadata.create_all(bind=engine)
    print("‚úì Tables created successfully")


def create_sample_data():
    """Create sample data for testing"""
    print("Creating sample data...")
    
    with Session(engine) as db:
        # Check if data already exists
        if db.query(User).count() > 0:
            print("Sample data already exists, skipping...")
            return
        
        # Create users
        users_data = [
            {
                "email": "anna@example.com",
                "username": "anna_chic",
                "password": "password123",
                "profile_text": "–ú–æ–¥–Ω—ã–π –±–ª–æ–≥–µ—Ä –∏ —Å—Ç–∏–ª–∏—Å—Ç. –õ—é–±–ª—é –¥–µ–ª–∏—Ç—å—Å—è –æ–±—Ä–∞–∑–∞–º–∏ –∏ —Å–æ–≤–µ—Ç–∞–º–∏ –ø–æ —Å—Ç–∏–ª—é."
            },
            {
                "email": "elena@example.com",
                "username": "elena_beauty",
                "password": "password123",
                "profile_text": "–ë—å—é—Ç–∏-–±–ª–æ–≥–µ—Ä. –¢–µ—Å—Ç–∏—Ä—É—é –∫–æ—Å–º–µ—Ç–∏–∫—É –∏ –¥–µ–ª—é—Å—å —Å–µ–∫—Ä–µ—Ç–∞–º–∏ —É—Ö–æ–¥–∞."
            },
            {
                "email": "maria@example.com",
                "username": "maria_travel",
                "password": "password123",
                "profile_text": "–ü—É—Ç–µ—à–µ—Å—Ç–≤–µ–Ω–Ω–∏—Ü–∞. –ò—Å—Å–ª–µ–¥—É—é –º–∏—Ä –∏ –¥–µ–ª—é—Å—å –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏—è–º–∏."
            }
        ]
        
        users = []
        for user_data in users_data:
            user = User(
                email=user_data["email"],
                username=user_data["username"],
                password_hash=get_password_hash(user_data["password"]),
                profile_text=user_data["profile_text"]
            )
            db.add(user)
            users.append(user)
        
        db.commit()
        print(f"‚úì Created {len(users)} users")
        
        # Create tags
        tags_data = [
            {"tag_name": "–º–æ–¥–∞", "tag_description": "–í—Å–µ –æ –º–æ–¥–µ –∏ —Å—Ç–∏–ª–µ"},
            {"tag_name": "–∫—Ä–∞—Å–æ—Ç–∞", "tag_description": "–ë—å—é—Ç–∏-—Å–æ–≤–µ—Ç—ã –∏ –æ–±–∑–æ—Ä—ã"},
            {"tag_name": "–ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è", "tag_description": "–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è –∏ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏—è"},
            {"tag_name": "—Å—Ç–∏–ª—å-–∂–∏–∑–Ω–∏", "tag_description": "–û–±—Ä–∞–∑ –∂–∏–∑–Ω–∏"},
            {"tag_name": "–∫—É–ª–∏–Ω–∞—Ä–∏—è", "tag_description": "–†–µ—Ü–µ–ø—Ç—ã –∏ –≥–∞—Å—Ç—Ä–æ–Ω–æ–º–∏—è"},
            {"tag_name": "–∏–Ω—Ç–µ—Ä—å–µ—Ä", "tag_description": "–î–∏–∑–∞–π–Ω –∏–Ω—Ç–µ—Ä—å–µ—Ä–∞"},
            {"tag_name": "–æ—Ç–Ω–æ—à–µ–Ω–∏—è", "tag_description": "–õ–∏—á–Ω—ã–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è"},
            {"tag_name": "—Å–∞–º–æ—Ä–∞–∑–≤–∏—Ç–∏–µ", "tag_description": "–õ–∏—á–Ω–æ—Å—Ç–Ω—ã–π —Ä–æ—Å—Ç"}
        ]
        
        tags = []
        for tag_data in tags_data:
            tag = Tag(**tag_data)
            db.add(tag)
            tags.append(tag)
        
        db.commit()
        print(f"‚úì Created {len(tags)} tags")
        
        # Create posts
        posts_data = [
            {
                "user": users[0],
                "title": "5 —Ç—Ä–µ–Ω–¥–æ–≤ –≤–µ—Å–Ω—ã 2025",
                "content": """–í–µ—Å–Ω–∞ 2025 –æ–±–µ—â–∞–µ—Ç –±—ã—Ç—å —è—Ä–∫–æ–π –∏ —Å—Ç–∏–ª—å–Ω–æ–π! –î–µ–ª—é—Å—å —Å –≤–∞–º–∏ –≥–ª–∞–≤–Ω—ã–º–∏ —Ç—Ä–µ–Ω–¥–∞–º–∏ —Å–µ–∑–æ–Ω–∞:

1. –ü–∞—Å—Ç–µ–ª—å–Ω—ã–µ –æ—Ç—Ç–µ–Ω–∫–∏ - —Ä–æ–∑–æ–≤—ã–π, –ª–∞–≤–∞–Ω–¥–æ–≤—ã–π –∏ –º—è—Ç–Ω—ã–π —Ü–≤–µ—Ç–∞ –±—É–¥—É—Ç –≤–µ–∑–¥–µ
2. –û–≤–µ—Ä—Å–∞–π–∑ - –∫–æ–º—Ñ–æ—Ä—Ç –∏ —Å—Ç–∏–ª—å –≤ –æ–¥–Ω–æ–º
3. –í–∏–Ω—Ç–∞–∂–Ω—ã–µ –∞–∫—Å–µ—Å—Å—É–∞—Ä—ã - –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ —Ä–µ—Ç—Ä–æ
4. –ù–∞—Ç—É—Ä–∞–ª—å–Ω—ã–µ —Ç–∫–∞–Ω–∏ - —ç–∫–æ–ª–æ–≥–∏—á–Ω–æ—Å—Ç—å –≤ –º–æ–¥–µ
5. –Ø—Ä–∫–∏–µ –∞–∫—Ü–µ–Ω—Ç—ã - –Ω–µ –±–æ–π—Ç–µ—Å—å –±—ã—Ç—å –∑–∞–º–µ—Ç–Ω—ã–º–∏!

–ö–∞–∫–æ–π —Ç—Ä–µ–Ω–¥ –≤–∞–º –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ –Ω—Ä–∞–≤–∏—Ç—Å—è? üíï""",
                "tags": [tags[0], tags[3]]
            },
            {
                "user": users[1],
                "title": "–ú–æ—è —É—Ç—Ä–µ–Ω–Ω—è—è —Ä—É—Ç–∏–Ω–∞ –∫—Ä–∞—Å–æ—Ç—ã",
                "content": """–£—Ç—Ä–æ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å —É—Ö–æ–¥–∞ –∑–∞ —Å–æ–±–æ–π! –î–µ–ª—é—Å—å —Å–≤–æ–µ–π beauty-—Ä—É—Ç–∏–Ω–æ–π:

‚òÄÔ∏è –£–º—ã–≤–∞–Ω–∏–µ –º—è–≥–∫–∏–º –≥–µ–ª–µ–º
üíß –£–≤–ª–∞–∂–Ω—è—é—â–∞—è —Å—ã–≤–æ—Ä–æ—Ç–∫–∞ —Å –≥–∏–∞–ª—É—Ä–æ–Ω–æ–≤–æ–π –∫–∏—Å–ª–æ—Ç–æ–π
üå∏ –õ–µ–≥–∫–∏–π –∫—Ä–µ–º –¥–ª—è –ª–∏—Ü–∞
üëÄ –ö—Ä–µ–º –¥–ª—è –æ–±–ª–∞—Å—Ç–∏ –≤–æ–∫—Ä—É–≥ –≥–ª–∞–∑
üíÑ –ò –∫–æ–Ω–µ—á–Ω–æ, SPF –∑–∞—â–∏—Ç–∞!

–í–µ—Å—å –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–Ω–∏–º–∞–µ—Ç –≤—Å–µ–≥–æ 10 –º–∏–Ω—É—Ç, –Ω–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ—Ç—Ä—è—Å–∞—é—â–∏–π. –ö–æ–∂–∞ —Å–∏—è–µ—Ç –≤–µ—Å—å –¥–µ–Ω—å! ‚ú®

–ê –∫–∞–∫–∏–µ –ø—Ä–æ–¥—É–∫—Ç—ã –≤ –≤–∞—à–µ–π —É—Ç—Ä–µ–Ω–Ω–µ–π —Ä—É—Ç–∏–Ω–µ?""",
                "tags": [tags[1], tags[3]]
            },
            {
                "user": users[2],
                "title": "–ù–µ–¥–µ–ª—è –≤ –ü–∞—Ä–∏–∂–µ: –º–æ–π –º–∞—Ä—à—Ä—É—Ç",
                "content": """–¢–æ–ª—å–∫–æ —á—Ç–æ –≤–µ—Ä–Ω—É–ª–∞—Å—å –∏–∑ —Ä–æ–º–∞–Ω—Ç–∏—á–Ω–æ–≥–æ –ü–∞—Ä–∏–∂–∞ –∏ —Ö–æ—á—É –ø–æ–¥–µ–ª–∏—Ç—å—Å—è –∏–¥–µ–∞–ª—å–Ω—ã–º –º–∞—Ä—à—Ä—É—Ç–æ–º –Ω–∞ –Ω–µ–¥–µ–ª—é! üóº

–î–µ–Ω—å 1-2: –ö–ª–∞—Å—Å–∏–∫–∞ - –≠–π—Ñ–µ–ª–µ–≤–∞ –±–∞—à–Ω—è, –õ—É–≤—Ä, –ï–ª–∏—Å–µ–π—Å–∫–∏–µ –ø–æ–ª—è
–î–µ–Ω—å 3: –ú–æ–Ω–º–∞—Ä—Ç—Ä –∏ –°–∞–∫—Ä–µ-–ö—ë—Ä
–î–µ–Ω—å 4: –í–µ—Ä—Å–∞–ª—å (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!)
–î–µ–Ω—å 5: –ú—É–∑–µ–∏ - –û—Ä—Å–µ –∏ –û—Ä–∞–Ω–∂–µ—Ä–∏
–î–µ–Ω—å 6: –®–æ–ø–∏–Ω–≥ –≤ –ú–∞—Ä–µ
–î–µ–Ω—å 7: –ü—Ä–æ–≥—É–ª–∫–∏ –ø–æ –°–µ–Ω–µ –∏ —Ä–∞—Å—Å–ª–∞–±–ª–µ–Ω–∏–µ –≤ –∫–∞—Ñ–µ

–°–æ–≤–µ—Ç—É—é –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –º—É–∑–µ–∏ –∑–∞—Ä–∞–Ω–µ–µ, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –æ—á–µ—Ä–µ–¥–µ–π. –ò –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –º–∞–∫–∞—Ä—É–Ω—ã –≤ Ladur√©e! ü•ê

–ö—Ç–æ –µ—â–µ –º–µ—á—Ç–∞–µ—Ç –æ –ü–∞—Ä–∏–∂–µ?""",
                "tags": [tags[2], tags[3]]
            },
            {
                "user": users[0],
                "title": "–ö–∞–ø—Å—É–ª—å–Ω—ã–π –≥–∞—Ä–¥–µ—Ä–æ–±: —Å —á–µ–≥–æ –Ω–∞—á–∞—Ç—å",
                "content": """–£—Å—Ç–∞–ª–∏ –æ—Ç –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–Ω–æ–≥–æ —à–∫–∞—Ñ–∞, –≥–¥–µ –Ω–µ—á–µ–≥–æ –Ω–∞–¥–µ—Ç—å? –ö–∞–ø—Å—É–ª—å–Ω—ã–π –≥–∞—Ä–¥–µ—Ä–æ–± - –≤–∞—à–µ —Ä–µ—à–µ–Ω–∏–µ!

–ù–∞—á–Ω–∏—Ç–µ —Å –±–∞–∑–æ–≤—ã—Ö –≤–µ—â–µ–π:
- –ë–µ–ª–∞—è —Ä—É–±–∞—à–∫–∞
- –ß–µ—Ä–Ω—ã–µ –±—Ä—é–∫–∏
- –î–∂–∏–Ω—Å—ã
- –ú–∞–ª–µ–Ω—å–∫–æ–µ —á–µ—Ä–Ω–æ–µ –ø–ª–∞—Ç—å–µ
- –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π —Ç—Ä–µ–Ω—á
- –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –æ–±—É–≤—å (—Ç—É—Ñ–ª–∏, –∫—Ä–æ—Å—Å–æ–≤–∫–∏, –±–æ—Ç–∏–ª—å–æ–Ω—ã)

–ö —ç—Ç–æ–π –±–∞–∑–µ –¥–æ–±–∞–≤–ª—è–π—Ç–µ —Å–µ–∑–æ–Ω–Ω—ã–µ –∞–∫—Ü–µ–Ω—Ç—ã. –í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ - –º–∏–Ω–∏–º—É–º –≤–µ—â–µ–π, –º–∞–∫—Å–∏–º—É–º –æ–±—Ä–∞–∑–æ–≤!

–î–µ–ª–∏—Ç–µ—Å—å, —É –∫–æ–≥–æ —É–∂–µ –µ—Å—Ç—å –∫–∞–ø—Å—É–ª—å–Ω—ã–π –≥–∞—Ä–¥–µ—Ä–æ–±? üëó""",
                "tags": [tags[0]]
            },
            {
                "user": users[1],
                "title": "–õ—É—á—à–∏–µ –∫–æ—Ä–µ–π—Å–∫–∏–µ –º–∞—Å–∫–∏ –¥–ª—è –ª–∏—Ü–∞",
                "content": """–ö-beauty –ø–æ–∫–æ—Ä–∏–ª–∞ –º–æ–π heart! üíó –î–µ–ª—é—Å—å —Ç–æ–ø-5 –º–∞—Å–æ–∫:

1. –¢–∫–∞–Ω–µ–≤—ã–µ –º–∞—Å–∫–∏ —Å –º—É—Ü–∏–Ω–æ–º —É–ª–∏—Ç–∫–∏ - –¥–ª—è —É–≤–ª–∞–∂–Ω–µ–Ω–∏—è
2. –ì–ª–∏–Ω—è–Ω—ã–µ –º–∞—Å–∫–∏ - –¥–ª—è –≥–ª—É–±–æ–∫–æ–≥–æ –æ—á–∏—â–µ–Ω–∏—è
3. –ù–æ—á–Ω—ã–µ –º–∞—Å–∫–∏ - –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–æ —Å–Ω–µ
4. Bubble –º–∞—Å–∫–∏ - –¥–ª—è —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è –∏ –æ—á–∏—â–µ–Ω–∏—è
5. –ì–µ–ª–µ–≤—ã–µ –ø–∞—Ç—á–∏ –ø–æ–¥ –≥–ª–∞–∑–∞ - —ç–∫—Å–ø—Ä–µ—Å—Å-—É—Ö–æ–¥

–ò—Å–ø–æ–ª—å–∑—É—é –º–∞—Å–∫–∏ 2-3 —Ä–∞–∑–∞ –≤ –Ω–µ–¥–µ–ª—é, –∏ –∫–æ–∂–∞ –±–ª–∞–≥–æ–¥–∞—Ä–∏—Ç! –†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–º–µ—Ç–µ–Ω —É–∂–µ –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è.

–ö–∞–∫–∏–µ –º–∞—Å–∫–∏ –ª—é–±–∏—Ç–µ –≤—ã?""",
                "tags": [tags[1]]
            }
        ]
        
        posts = []
        for post_data in posts_data:
            post = Post(
                user_id=post_data["user"].id,
                post_title=post_data["title"],
                post_content=post_data["content"],
                is_published=True
            )
            post.tags.extend(post_data["tags"])
            db.add(post)
            posts.append(post)
        
        db.commit()
        print(f"‚úì Created {len(posts)} posts")
        
        # Create some comments
        comments_data = [
            {
                "post": posts[0],
                "user": users[1],
                "text": "–û–±–æ–∂–∞—é –ø–∞—Å—Ç–µ–ª—å–Ω—ã–µ –æ—Ç—Ç–µ–Ω–∫–∏! –£–∂–µ –∑–∞–ø–∞—Å–∞—é—Å—å —Ä–æ–∑–æ–≤—ã–º üíï"
            },
            {
                "post": posts[0],
                "user": users[2],
                "text": "–í–∏–Ω—Ç–∞–∂ - —ç—Ç–æ —Ç–æ—á–Ω–æ –º–æ–µ! –°–ø–∞—Å–∏–±–æ –∑–∞ –∏–¥–µ–∏!"
            },
            {
                "post": posts[1],
                "user": users[0],
                "text": "–û—Ç–ª–∏—á–Ω–∞—è —Ä—É—Ç–∏–Ω–∞! –¢–æ–∂–µ –Ω–µ –º–æ–≥—É –±–µ–∑ —É—Ç—Ä–µ–Ω–Ω–µ–≥–æ —É—Ö–æ–¥–∞ ‚ú®"
            },
            {
                "post": posts[2],
                "user": users[0],
                "text": "–ü–∞—Ä–∏–∂ - –≥–æ—Ä–æ–¥ –º–µ—á—Ç—ã! –°–ø–∞—Å–∏–±–æ –∑–∞ –º–∞—Ä—à—Ä—É—Ç üóº"
            }
        ]
        
        for comment_data in comments_data:
            comment = Comment(
                post_id=comment_data["post"].id,
                user_id=comment_data["user"].id,
                comment_text=comment_data["text"]
            )
            db.add(comment)
        
        db.commit()
        print(f"‚úì Created {len(comments_data)} comments")
        
        print("\n‚úì Sample data created successfully!")
        print("\nSample credentials:")
        print("  Email: anna@example.com | Password: password123")
        print("  Email: elena@example.com | Password: password123")
        print("  Email: maria@example.com | Password: password123")


if __name__ == "__main__":
    init_db()
    create_sample_data()
